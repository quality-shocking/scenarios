# yksym

(書き方の例として[テンプレート](../../template/README.md)を参照してください)

## 収録場所/日時

* 時間: 2019-05-05 17:30-20:00
* 会議室: yksymさん職場
* 集合時間/場所: 2019-05-05 17:00 [ビック酒販 AKIBA店](https://goo.gl/maps/vJUegmvrcPT2cGkn9)
* 緊急連絡先: 090-3524-7064

## 番組の紹介

* ホスト/ゲスト「こんにちはー」
* ホスト「クオリティショッキングは毎回ゲストを迎えてソフトウェアの品質についてあーでもないこーでもないと話しあうチャンネルです。」

## ゲストの紹介

* ホスト「yksym(いくしむ)さんこんにちは。まずは簡単に自己紹介をしていただけますか？」
* ゲスト「こんにちは皆さん。yksymです。xxx 職場の痕跡が残らない範囲で自己紹介 xxx」

## yksymメモ

どんな失敗があったか？
-----------------------

上の定義を見ながら、所属組織関係なく過去にどんな失敗が発生したか覚えている範囲で振り返ってみると少なくとも下の6種類がある。

1. 環境の定義に失敗
    * 実験施設ではうまくいくけど顧客が使いたかった場所では期待した動作にならない
    * ネットワーク特性(安定度やら帯域やら)、温度、OS、マシンスペック、電源スペック、依存ライブラリ、周辺機器の違いで期待した動作にならない
3. 明示的な要求を満たすことに失敗
    * 「プロトタイピングだから正常系だけ動けば良い」という顧客の言葉を誤解して、高い信頼性を求められていることに気付けなかった
    * 顧客が提示した 受け入れ試験 にさえクリア出来れば良いという誤解(当たり前だけど実運用とは異なる環境であることが多い)
    * 妥当性のない仕様の記述をしていてその発覚が出来なかった
    * 設計・実装時の不具合埋め込み及びその発覚が出来なかった
4. 暗黙的な期待の抽出に失敗
    * 作ったシステムは顧客が抱える問題を上手く解けていなかった（十分な信頼性や正確性がなかったり、使い辛かったり)
    * 開発側が制約やリスクについて正しく伝えることにが出来なかった
    * ドメイン知識が不足していて開発側が思い込んでいた事前条件が崩れたり、必要な不変条件や事後条件が抜けていたりしていて手戻りが発生
7. 時間切れ
    * 取り組む優先順位を間違えて、期限までに十分な価値を提供出来ない
    * 不確実性や工数の都合もあって十分な分析・検討が受注の前に出来ず、見積りがブレる
    * 機能を過剰にリッチにしてしまうとか、価値の高い機能から実装していないとか
    * 選定や発注の失敗(品質が悪いモノが来たり、納期が遅れたり）



6. 動的に変化する要望/仕様やステークホルダを管理することに失敗
    * 適切な仕様管理、プロジェクト管理プロセスが導入されておらず、いつの間にか各ステークホルダーが異なるスケジュール、異なる仕様を見ている
2. ステークホルダーの定義に失敗
    * 開発者、発注者以外が開発開始時点で存在せず、仮定に仮定を重ねてしまう（保守運用のオペレーター、エンドユーザー、販売、法務関係等)

失敗の原因は？
----------

沢山あるが、一番頻度と深刻度が高いものは3つ。

* (a) 開発者が解くべき問題について十分に理解していない
    * 仕様を記述しても開発者はその妥当性が判断出来ない
    * 取り組む優先順位を間違える

* (b) 品質を測ることが出来ていない
    * 品質の評価方法はスプリントレビュー時の顧客からのフィードバックに依存している
        * レビュー参加者だけで適切に評価出来るとも限らない
        * 開発環境での短時間の動作の様子はチャンピョンデータみたいなもの
        * 記述された仕様を見ても、顧客はその不十分さや曖昧さに気付けない
    * 不具合が出てくるまで品質の悪さが認識出来ない(不十分なテストや未評価の状態を品質良好と錯覚してしまう)

* (c) 非機能要求への軽視や誤解
    * 機能実装を優先して非機能テストやバグ修正を後回しにしてしまう
        * 非機能要求テストは別ストーリーになってしまっていて、バックログの下の方にいたりする
        * 規模が膨らむ程、ビッグバンの危険やバグ修正コストは高くなる
    * ユーザーストーリーや仕様に非機能面の記述がなかったり曖昧だったり
        * 非機能試験を通さずに、機能実装を完了したと錯覚してしまう(非機能という名前が錯覚の原因な気がする)
        * 開発の途中だから、後で別途テスト・評価するから、という甘えがある


何から手をつける？
----------

* (a) 問題について記述する
    * SRS/SyRSといった要求仕様書([3])に自然言語で書く
        * エレベーターピッチ程度に留めず、各機能がどういう価値を誰に提供するものなのか説明出来ると良いのかもしれない(時間やお金の節約、リスクの回避)
    * 問題のモデルを作る
        * 物事を理解する一番の方法は作ること(情報の整理や推敲の点で大変効果がある)
        * コンテキスト図[4]が参考になる
        * Open Modele, Model Validation とか

* (b) 品質評価方法を極力具体的・限定的に定義して仕様や制約として取り込む
    * 書かない or 曖昧に書くより、限定した方が誤解が少なく、フィードバックも得やすいし、テストしやすい
    * とりあえず、プロトタイピングだから後で決めるはやめる。分からなければ、仮説を立てて決定する。ただし検証を可能な限り早くスケジューリングする。
    * 人間は欲しいモノの十分条件は分からなくても、必要条件を見つけることは得意(何が欲しいかうまく説明出来なくてもソレが欲しいかどうかは判定出来たりする)
    * Tests as Documentation, Specification by Example とか

* (c) 品質評価作業のスケジューリングを見直す
    * 機能実装に回帰テストに非機能要求に対するテストも盛り込む


参考文献
-------

* [1] [SWEBOK](http://swebokwiki.org/)
* [2] [組込みソフトウェア開発における品質向上の勧め バグ管理手法編](https://www.ipa.go.jp/files/000027629.pdf)
* [3] [ソフトウェア要求](https://www.amazon.co.jp/ソフトウェア要求-第3版-Karl-Wiegers、Joy-Beatty/dp/4822298396)
* [4] [プロブレムフレーム ソフトウェア開発問題の分析と構造化](https://www.amazon.co.jp/プロブレムフレーム-ソフトウェア開発問題の分析と構造化-Architects-ソフトウェア開発の課題3-Archiveソフトウェア開発の課題/dp/4798108782)
```


### (ハードウェアスタートアップとしての)理想的な受託開発フロー

* 理想というか、生産性(達成品質/時間)という観点でスクラムのようなアプローチは割といい線いってるとは思う(早く作って早く評価する)

* 受託でスクラムやる上で問題になっている点
    * 不確実性や工数の都合もあって十分な分析・検討が受注の前に出来ず、見積りがブレる
    * マンリソースが少ないとどうしてもマルチプロジェクトにならざるを得ない(コンテキストスイッチのコストとコミュニケーションコストがヤバイ。スケジュールも見失いやすく、バックログも腐りやすくなる)
    * 調達や外注製造のリスク顕在化（品質やレイテンシ）


---

* 品質確保しようと思うと十分な時間が必要。特に品質評価は早い段階から何回も行えるだけの時間を確保したい(まぁ実際にはそう上手く行かないことが多いが)
    * メカ・電気については３回以上は作ってみないと収束しない傾向があるように見える
    * HW開発でスクラムやるんだったら社内に製造設備・実験場は必須だなとは思う

* SW屋から見てHWが辛い点は沢山ある
    * モノは移動、コピー、製造に時間と金と失敗リスクが発生する(失敗のコストが大きく、見積もりのブレも大きくなる)
        * 試作 -> フィードバックのループを回すのに時間がかかる(機械学習とかでもそうだけど) => お金を使って投機実行したり・・・
        * 作って現地で動かさないと分からないことが沢山ある
    * モノがよく劣化したり、変化したり、壊れたりする
    * モノは物理法則や空間的な制約によってモジュール間に依存関係が発生する
    * モノがないと開発者は作業出来ない場合が多い（リモートワークし辛い)
    * メカ・電気・ソフトの問題切り分けが大変、個体差とかもある
    * 開発部屋がうるさい、モノが溢れる、モノがなくなる、オフィスが手狭になる（コストフル）
    * モノを探す時間が増す（いつのまにか移動したり捨てられたり）
    * 現場環境が過酷な時もある(暑いとかトイレないとかネット回線ないとか)
    * 特許や規格の問題
    * 理論計算と現実のギャップ

---

### CSP検査ツールを自作した話

* FDR買えば良かった(金で解決出来る問題は金で解決すべきだ)

### TLA+を組み込み開発で運用してみた話

* 話題になってたTLA+触ってみたかった
* ブラックボックスなアプリのモデルを記述するのに使った
* 使ってみた感想
    * 状態遷移を論理式で表していく
    * 直感的かつ使いやすい
    * 動的型付辛い＆ツールの吐くエラーに行番号ない時発狂する＆集合の要素数の上限低すぎ..
* 他のモデル検査とTLA+の比較は[ここ](../spec20180810/memo.md) に書いた


### UMLモデリングと形式的なモデリングの違い

* UML/SysMLの状態遷移図やユースケース図といったものを形式的なモデルを使って表現しようとしてきた
* UML/SysMLの図は誰でも読めてなんとなく書けるという点で扱いやすく、自然言語よりもイメージを伝えやすい一方、パラメトリックな表現が難しく、ページや画面の制約を受ける(表現力が乏しい)
* 形式的に記述すると誰でも読めないし、書いてある情報からイメージに変換するのにコストがかかるし、見落としもしやすい。しかし表現力は高く、検査も出来る。


### 定理証明と形式的なモデリングの違い

* 定理証明の定義よく知らない
* モデル作って振る舞いの表明するところまでは同じでは？
* 証明用の言語とか型システムやアノテーション使って証明するのが定理証明のイメージ

### そもそも形式的なモデル/テスト/定理証明などの異なる手法によって削減できる不具合は異なるのか

* 異なると思う。加えて不具合の種別ってフェーズで区切ることが多いが、こういった不具合をいつ検出出来るが重要。
* モデルを仕様に使えば、要求の問題をその段階で検出出来る期待してる。実装の問題はテストなり定理証明なりで実装中または後に検出することになると思う。
* あとテスト作る為にモデルはあった方が良い


### TLA+の検査時間をz3などの外部ソルバで短縮できる？

* ごめんなさい。正直分からないです。プロファイルとってみないと何故遅いか分からないし、z3がそれを解決するかもさっぱり分からない。
* ただの推測だけど、状態爆発して馬鹿でかいファイル吐きまくってる現状を鑑みると、そういった爆発を抑えこむ工夫がz3にあるならマシにはなるのでは？
* ちなみに今はそんなに時間かけずに検査してます
    * イベントの種類や状態の数が大きくなると遷移回数5を確保することすら難しくなるので不安は残る(テストケースの最大イベント数である50程度の深さは欲しい)
    * 初期状態を増やすことで誤魔化してる


### 某L社での形式手法との比較

* 当時のツールは検査が出来なかったのでレビューで正しさを担保していた。
    * コレがボクにはキツかった。並行合成人間には無理
    * 当時の尊敬するBOSSは頭の中にZ3ソルバ持ってて普通にチェックしてた
    * 最近そのツールが進化して検査も出来るようになったらしい。スゴイ・・・
* QAチームや慣れない開発者のことを考慮してた
    * 記述は日本語併記(QAチームでもエンジニア指向の人達は普通に日本語読まなくなって式追ってたのにビックリしたが)
    * DRYよりDAMP優先だった(私はDRY派)

### 納品時にお客様が「成果物が想定と違う」と主張された時に我々は何ができるのか

過去に戻ることは出来ない。原因を振り返って、次のゴールを決めて合意するしかない。

### 段階的詳細化をして、実装に近いモデルを得ることは実際のビジネスでは機能するのか

* 近いの度合いによるけど、非同期系のバグ潰す為にモジュール設計の妥当性担保くらいは実例あるので機能すると思う
* ただ、ブラックボックスのライブラリやハードの振る舞いを直接モデル化するのは辛そう(メーカーやライブラリ製作者がモデル用意してくれたらいいのに)


### そもそも元のモデルの筋が悪ければ、段階的詳細化をしても筋の良い詳細なモデルは得られないのでは

筋の良し悪しとはなんだろう？美しい設計や実装と同じようなニュアンス？

### 筋の良いモデルであれば、抽象度の高いモデルのまま加工すれば良いのでは

加工とは？何が得られる？

### 最適化されたアルゴリズムが元のアルゴリズムの仕様を違反していないか主張する良い方法

* 正直な所、分からない
    * これが欲しくて定理証明とか勉強しはじめた覚えがある
    * プログラム単位なんだったら最適化はコンパイラが勝手にやってくれというのが正直な気持ち
    * 等価性の研究とかチラ見したけど、ふ〜んで終わった覚えがある。bisimulationとか。
* 思いつく範囲で
    * よくやるのが網羅テストで結果の一致度合いをみる
    * Isabelleとかで振るまい一致をチェックする(手続き言語用のもあったハズ)
    * 元のアルゴリズムの入出力の関係が表現出来るなら依存型使った定理証明とか
    * 数式ならmathmaticaとかでいいのでは(まぁ実際の所、1bitもずらすなとか言われる場合があって辛かったりするけど)
    * アルゴリズムというのがアクセラレーターの振る舞いを含んだりすると途端に大変になりそうだけど・・・

### 定理証明の先に未来はあるのか

ど素人だけど、論理学や計算論というものが終わりを迎えるとは到底思えない。
反例探索の効率化とか証明の自動化の進化については、よく分からない。


### 形式的なモデルは何時までメンテナンスし続けるべきか

プロジェクトが終了するまで

### 読書時間の確保の方法とその集中のためにどんな手法が使えるのか

通勤時間

### 家事育児の中での研究開発時間の確保方法

研究開発は仕事でやるべき・・・

### おすすめ書籍紹介

誰向けかにもよるけれど、一番お世話になってる本はソフトウェア要求。面白かった本はプログラミングの科学。


### 一言

* モデル書くのはゲーム作ってるみたいで楽しい。

## クロージング

* ホスト「と盛り上ってきたところで時間が来てしまいました。最後に一言ありますでしょうか？」
* ゲスト「xxx」
* ホスト/ゲスト「ありがとうございました!」
* ホスト「もし気に入っていただけたらチャンネル登録よろしくお願いします」

## (YouTubeページ下へ付記する)リンク集

* http://yksym.github.io/
* https://github.com/yksym

## YouTube動画

xxx 未だ
